<% layout('layout') -%>

<h1>Jobs Monitor</h1>
<div class="row">
  <div class="col-md-12">
    <b>Totol Count:</b> <%= jobs.length %>
  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>name</th>
          <th>current_partition</th>
          <th>latency</th>
          <th>average processing time</th>
          <th>average latency</th>
          <th>current_status</th>
          <th>pid</th>
          <th>frequency</th>
          <th>start_time</th>
          <th>author</th>
          <th>command</th>
        </tr>
      </thead>
      <tbody>
        <% jobs.forEach(function(job){ %>
        <tr>
          <td><%= job.name %></td>
          <td><%= partition(job.frequency, job.current_partition_time) %></td>
          <td><%= formatDuration(job.latency) %></td>
          <td><%= formatDuration(job.average_processing_time) %></td>
          <td><%= formatDuration(job.average_latency) %></td>
          <td><%= job.status %></td>
          <td><%= job.pid || 'N/A' %></td>
          <td><%= job.frequency %></td>
          <td><%= formatTime(job.start_time) %></td>
          <td><%= job.author %></td>
          <td>
            <div>
              <button class="btn btn-primary btn-xs jm-start" data-partition="<%= partition(job.frequency, job.current_partition_time) %>" data-name="<%= job.name %>">Start</button>
              <button class="btn btn-danger btn-xs jm-stop" data-name="<%= job.name %>">Stop</button>
              <a class="btn btn-default btn-xs" href="/log?job_name=<%= job.name %>">Log</a>
            </div>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>